<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Portfolio Upload</title>
<style>
  :root {
    --main-color: #000;
    --hover-color: #444;
    --bg-color: #f8f8f8;
    --border-style: 2px dashed #000;
  }
  * { box-sizing: border-box; transition: all 0.2s ease; }
  body {
    background: var(--bg-color);
    font-family: "Inter", Arial, sans-serif;
    color: #111;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    min-height: 100vh;
    padding: 40px 20px;
  }
  h1 { font-weight: 700; letter-spacing: 0.5px; margin-bottom: 20px; }

  #projectForm {
    width: 90%;
    max-width: 1000px;
    margin-bottom: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  input, textarea {
    width: 100%;
    font-size: 1rem;
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-family: inherit;
    resize: none;
    overflow: hidden;
  }

  textarea { min-height: 5em; }

  button {
    width: fit-content;
    padding: 10px 16px;
    border-radius: 6px;
    border: none;
    background: var(--main-color);
    color: #fff;
    font-weight: 500;
    cursor: pointer;
  }

  button:hover { background: var(--hover-color); }

  #canvas {
    width: 90%;
    max-width: 1000px;
    aspect-ratio: 1.414;
    border: var(--border-style);
    background: #fff;
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    border-radius: 10px;
    overflow-y: auto;
    max-height: 80vh;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 60px;
  }

  #placeholder {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.6rem;
    color: #bbb;
    text-align: center;
    font-weight: 500;
    pointer-events: none;
    z-index: 0;
  }

  #canvas > *:not(#placeholder) { z-index: 1; }

  .project-container {
    width: 100%;
	  margin-top: 4px;
/*    margin-bottom: 16px;*/
/*    padding: 12px 16px;*/
    border-radius: 10px;
/*    background: #fafafa;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);*/
  }

  .project-container h3 {
    margin: 0 0 8px 0;
    font-weight: 700;
  }

  .project-container p {
    margin: 0;
    line-height: 1.6;
  }

  .project-container b { font-weight: 700; }
  .project-container i { font-style: italic; }
  .project-container ul { padding-left: 20px; margin: 5px 0; }
  .project-container li { margin-bottom: 4px; }

  .toolbar {
    margin-top: 25px;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    background: #fff;
    padding: 12px 20px;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    position: sticky;
    bottom: 20px;
    z-index: 10;
  }

  .photo-grid {
   display: grid;
   grid-template-columns: repeat(3, 1fr);
   gap: 4px;
   width: 100%;
   }
  .photo-grid img {
  width: 100%;
  border-radius: 8px;
  border: none;
  display: block;
  margin: 0;   /* đảm bảo không có margin mặc định */
  padding: 0;  /* đảm bảo không có padding */
}

  img, iframe, audio, model-viewer {
    width: 100%;
    /*margin-top: 12px;*/
    border-radius: 8px;
    border: none;
  }

  audio { outline: none; }

  #canvas::-webkit-scrollbar { width: 8px; }
  #canvas::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
</style>
</head>
<body>

<h1>Portfolio Upload</h1>

<div id="projectForm">
  <input type="text" id="projectTitle" placeholder="Tên dự án">
  <textarea id="projectDesc" placeholder="Mô tả dự án (Markdown: **bold**, *italic*, - list)"></textarea>
  <button onclick="addProjectInfo()">Thêm dự án vào canvas</button>
</div>

<div id="canvas" contenteditable="false">
  <div id="placeholder">Portfolio Upload</div>
</div>

<div class="toolbar">
  <!--<button onclick="addText()">Text</button>-->
  <button onclick="addImage()">Image</button>
  <button onclick="addPhotoGrid()">PhotoGrid</button>
  <button onclick="addVideo()">Video</button>
  <button onclick="addAudio()">Audio</button>
  <button onclick="addEmbed()">Embed</button>
  <button onclick="addLightroom()">Lightroom</button>
  <button onclick="add3D()">3D</button>
</div>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<script>
const canvas = document.getElementById('canvas');
const placeholder = document.getElementById('placeholder');
const textarea = document.getElementById('projectDesc');

function togglePlaceholder() {
  const hasContent = [...canvas.children].some(el => el.id !== 'placeholder');
  placeholder.style.display = hasContent ? 'none' : 'block';
}

// Auto resize textarea
textarea.addEventListener('input', () => {
  textarea.style.height = 'auto';
  textarea.style.height = textarea.scrollHeight + 'px';
});

// Thêm project markdown cũ
function addProjectInfo() {
  const title = document.getElementById('projectTitle').value.trim();
  const desc = document.getElementById('projectDesc').value.trim();
  if(!title && !desc) { alert("Vui lòng nhập tên hoặc mô tả dự án!"); return; }

  const container = document.createElement('div');
  container.className = 'project-container';

  if(title) {
    const h3 = document.createElement('h3');
    h3.textContent = title;
    container.appendChild(h3);
  }

  if(desc) {
    let html = desc
      .replace(/\*\*(.*?)\*\*/g, "<b>$1</b>") 
      .replace(/\*(.*?)\*/g, "<i>$1</i>") 
      .replace(/^- (.*)$/gm, "<li>$1</li>");

    if(html.includes("<li>")) html = "<ul>" + html + "</ul>";
    html = html.replace(/\n/g, "<br>");

    const p = document.createElement('p');
    p.innerHTML = html;
    container.appendChild(p);
  }

  canvas.appendChild(container);
  togglePlaceholder();

  document.getElementById('projectTitle').value = '';
  document.getElementById('projectDesc').value = '';
  textarea.style.height = 'auto';
}

// Hàm chung để thêm card mới
function createCard(contentElement) {
  const card = document.createElement('div');
  card.className = 'project-container';
  card.appendChild(contentElement);
  canvas.appendChild(card);
  togglePlaceholder();
}

// Thêm Text
function addText() {
  const text = prompt("Nhập nội dung text (dùng \\n để xuống dòng):");
  if (text) {
    const p = document.createElement('p');
    p.textContent = text.replace(/\\n/g,"\n");
    createCard(p);
  }
}

// Thêm Image
function addImage() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.onchange = e => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = event => {
      const img = document.createElement('img');
      img.src = event.target.result;
      createCard(img);
    };
    reader.readAsDataURL(file);
  };
  input.click();
}

// Thêm PhotoGrid
function addPhotoGrid() {
  const input = document.createElement('input');
  input.type = 'file';
  input.multiple = true;
  input.accept = 'image/*';
  input.onchange = e => {
    const grid = document.createElement('div');
    grid.className = 'photo-grid';
    [...e.target.files].forEach(file => {
      const reader = new FileReader();
      reader.onload = ev => {
        const img = document.createElement('img');
        img.src = ev.target.result;
        grid.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
    createCard(grid);
  };
  input.click();
}

// Thêm Video
function addVideo() {
  const url = prompt("Dán link YouTube:");
  if (url) {
    const iframe = document.createElement('iframe');
    iframe.src = url.replace("watch?v=", "embed/");
    iframe.height = "400";
    iframe.allowFullscreen = true;
    createCard(iframe);
  }
}

// Thêm Audio
function addAudio() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'audio/*';
  input.onchange = e => {
    const file = e.target.files[0];
    const audio = document.createElement('audio');
    audio.controls = true;
    audio.src = URL.createObjectURL(file);
    createCard(audio);
  };
  input.click();
}

// Thêm Embed
function addEmbed() {
  const code = prompt("Nhập iframe hoặc URL embed:");
  if (code) {
    let el;
    if (code.startsWith("<iframe")) {
      const wrapper = document.createElement('div');
      wrapper.innerHTML = code;
      el = wrapper.firstChild;
    } else {
      const iframe = document.createElement('iframe');
      iframe.src = code;
      iframe.height = "400";
      el = iframe;
    }
    createCard(el);
  }
}

// Thêm Lightroom
function addLightroom() {
  const link = prompt("Dán link bộ sưu tập Lightroom:");
  if (link) {
    const iframe = document.createElement('iframe');
    iframe.src = link;
    iframe.height = "500";
    createCard(iframe);
  }
}

// Thêm 3D
function add3D() {
  const link = prompt("Dán link Sketchfab hoặc file .glb:");
  if (link) {
    let el;
    if (link.includes("sketchfab")) {
      const iframe = document.createElement('iframe');
      iframe.src = link+"/embed";
      iframe.height="500";
      iframe.allow="autoplay; fullscreen; vr";
      iframe.allowFullscreen=true;
      el = iframe;
    } else if (link.endsWith(".glb")) {
      const mv = document.createElement('model-viewer');
      mv.src = link;
      mv.alt = "3D Model";
      mv.cameraControls = true;
      mv.autoRotate = true;
      mv.style.height="500px";
      el = mv;
    } else { alert("Link không hợp lệ."); return; }
    createCard(el);
  }
}
</script>
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

</body>
</html>
